# Week 24/11/25: Feature Extraction Module

**Milestone:** Develop feature extraction module (MFCC and Chroma features)
**Status:** ✅ Completed
**Date:** November 24, 2025

## Overview

This milestone implements the core feature extraction functionality that will enable audio similarity detection. The module extracts MFCC (Mel-Frequency Cepstral Coefficients) and Chroma features from audio files, which are essential for identifying melodic and rhythmic similarities.

## Implemented Features

### 1. Feature Extraction Module (`feature_extractor.py`)

Created a comprehensive feature extraction module with the following capabilities:

**AudioFeatureExtractor Class:**
- MFCC extraction with 13 coefficients
- Chroma feature extraction (12 pitch classes)
- Tempo and beat detection
- Statistical aggregation (mean, std, min, max)
- JSON-based feature storage and retrieval

**Key Parameters:**
- `n_mfcc`: 13 (standard for audio recognition)
- `n_chroma`: 12 (12 pitch classes: C through B)
- `n_fft`: 2048 (FFT window size)
- `hop_length`: 512 (samples between frames)

### 2. API Integration

Enhanced the Flask API to automatically extract features on upload:

**Modified Endpoints:**
- `POST /api/upload`: Now extracts and saves features automatically
  - Returns feature extraction status and timing
  - Includes file ID for feature retrieval
  - Saves features to JSON in `features/` directory

**New Endpoints:**
- `GET /api/features`: List all extracted feature files
- `GET /api/features/<file_id>`: Retrieve specific feature file

### 3. Feature Storage

**Storage Structure:**
```
backend/
├── features/                    # Feature storage directory
│   ├── {filename}_{id}_features.json
│   └── ...
└── uploads/                     # Audio files
```

**Feature File Format:**
```json
{
  "audio_info": {
    "filename": "...",
    "duration": 5.0,
    "sample_rate": 22050,
    "tempo": 120.0,
    "num_beats": 10
  },
  "mfcc": {
    "mfcc": [[...], [...]],      // Full MFCC matrix
    "mfcc_mean": [...],           // Statistical summaries
    "mfcc_std": [...],
    "shape": [13, 216],
    "n_mfcc": 13
  },
  "chroma": {
    "chroma": [[...], [...]],     // Full Chroma matrix
    "chroma_mean": [...],
    "chroma_std": [...],
    "shape": [12, 216],
    "pitch_classes": ["C", "C#", ...]
  },
  "extraction_time": 0.029
}
```

### 4. Performance Testing

Created comprehensive test suite (`test_features.py`):

**Test Coverage:**
- Feature extraction validation
- MFCC feature verification
- Chroma feature verification
- Audio info extraction
- Save/load functionality
- Performance benchmarking

**Test Results:**
```
✅ ALL TESTS PASSED
- MFCC coefficients: 13 x 216 frames
- Chroma features: 12 x 216 frames
- Average extraction time: 0.029s
- Feature file size: 154.2 KB
- Performance target met (< 5s)
```

## Technical Details

### MFCC Features

**Purpose:** Capture timbral texture and sound quality
- Represents short-term power spectrum of audio
- 13 coefficients per time frame
- Commonly used in audio recognition tasks

**Output Shape:** (13, n_frames)
- 13 MFCC coefficients
- n_frames depends on audio length

### Chroma Features

**Purpose:** Capture harmonic and melodic characteristics
- Represents intensity of 12 pitch classes
- Useful for melody similarity detection
- Transposes-invariant (relative pitch)

**Output Shape:** (12, n_frames)
- 12 pitch classes (C, C#, D, D#, E, F, F#, G, G#, A, A#, B)
- n_frames depends on audio length

### Additional Features

- **Tempo Detection:** Beats per minute (BPM)
- **Beat Tracking:** Number of detected beats
- **Statistical Summaries:** Mean, std, min, max for each feature

## File Changes

### New Files
- `backend/feature_extractor.py` - Core feature extraction module
- `backend/test_features.py` - Comprehensive test suite
- `backend/features/` - Directory for feature storage
- `WEEK_24_11_25.md` - This documentation

### Modified Files
- `backend/app.py` - Enhanced with feature extraction on upload
  - Added feature extraction imports
  - Modified `/api/upload` to extract features
  - Added `/api/features` endpoints
  - Added features folder configuration

## Usage Examples

### Extract Features via API

```bash
# Upload file and extract features
curl -X POST -F 'file=@song.mp3' http://localhost:5000/api/upload

# Response includes:
# {
#   "file_id": "a1b2c3d4",
#   "features": {
#     "extracted": true,
#     "extraction_time": 0.029,
#     "mfcc_shape": [13, 216],
#     "chroma_shape": [12, 216]
#   }
# }

# Retrieve features by file_id
curl http://localhost:5000/api/features/a1b2c3d4

# List all features
curl http://localhost:5000/api/features
```

### Direct Module Usage

```python
from feature_extractor import AudioFeatureExtractor

# Initialize extractor
extractor = AudioFeatureExtractor()

# Extract features from audio file
features, time = extractor.extract_all_features('audio.mp3')

# Access MFCC features
mfcc_mean = features['mfcc']['mfcc_mean']  # (13,)
mfcc_full = features['mfcc']['mfcc']       # (13, n_frames)

# Access Chroma features
chroma_mean = features['chroma']['chroma_mean']  # (12,)
chroma_full = features['chroma']['chroma']       # (12, n_frames)

# Save features
extractor.save_features(features, 'features/output.json')
```

## Performance Metrics

**Extraction Speed:**
- 5-second audio file: ~0.029s average
- Well under 5-second target
- Suitable for real-time processing

**Feature File Size:**
- Approximately 154 KB for 5-second audio
- Scales linearly with audio duration
- JSON format for easy inspection

**Memory Usage:**
- Efficient processing with librosa
- Features stored as JSON (human-readable)
- No memory leaks in repeated extractions

## Testing

Run the test suite:

```bash
cd backend
source venv/bin/activate
python test_features.py
```

Expected output:
- ✅ All 6 tests passing
- Performance metrics
- Feature validation confirmation

## Integration with Existing System

The feature extraction module integrates seamlessly with the Week 17/11/25 upload system:

1. User uploads audio file via web interface
2. Backend saves file and extracts features automatically
3. Features stored in JSON format
4. Response includes feature summary
5. Features can be retrieved later via API

## Next Steps (Week 1/12/25)

With feature extraction complete, the next milestone will implement:
- Similarity calculation algorithms (DTW, Cosine similarity)
- Comparison API endpoint
- Feature-to-feature comparison logic
- Similarity score generation

## Dependencies

All dependencies already present in `requirements.txt`:
- librosa==0.10.1 (audio processing)
- numpy==1.24.3 (numerical operations)
- scipy==1.11.4 (scientific computing)
- Flask==3.0.0 (web framework)

## Notes

- MFCC features capture timbral characteristics (sound quality)
- Chroma features capture harmonic content (melody/pitch)
- Both features are essential for comprehensive similarity detection
- Features are stored permanently for later comparison
- System is ready for similarity algorithm implementation

## Validation

✅ Feature extraction working correctly
✅ MFCC and Chroma features validated
✅ API integration complete
✅ Save/load functionality tested
✅ Performance targets met
✅ All tests passing

**Ready for Week 1/12/25: Similarity Calculation Algorithm**
