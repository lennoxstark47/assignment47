# Week 17/11/25: Audio Upload & Waveform Display

**Milestone:** Implement audio file upload and basic waveform display
**Status:** ✅ Completed

## Overview

This week focused on building the core infrastructure for audio file handling:
- Flask backend with file upload endpoint
- Frontend interface for drag-and-drop file upload
- Real-time waveform visualization
- Audio metadata display

## What Was Implemented

### Backend (Flask Application)

**New Files:**
- `backend/app.py` - Main Flask application with upload endpoint
- `backend/test_upload.py` - Automated test script

**Key Features:**
- `/api/upload` endpoint accepting audio files (MP3, WAV, OGG, FLAC, M4A)
- File validation (type and size checking)
- Audio processing with Librosa
- Waveform downsampling for efficient frontend display (1000 points)
- Audio metadata extraction (duration, sample rate, RMS energy)
- `/api/health` endpoint for service monitoring

### Frontend (Web Interface)

**New Files:**
- `frontend/index.html` - Complete single-page application

**Key Features:**
- Drag-and-drop file upload interface
- Click-to-select file option
- Real-time upload status messages
- Waveform canvas visualization
- Audio information cards displaying:
  - Filename
  - Duration
  - Sample rate
  - Total samples
  - RMS energy
- Responsive design with gradient UI
- Error handling and user feedback

## Technical Details

### Audio Processing Pipeline

1. **File Upload**: User selects audio file via drag-drop or file picker
2. **Validation**: Backend validates file type and size (max 10MB)
3. **Processing**: Librosa loads and analyzes the audio:
   - Loads audio in mono
   - Preserves original sample rate
   - Calculates duration and RMS energy
4. **Downsampling**: Waveform reduced to 1000 samples for efficient visualization
5. **Response**: JSON data sent to frontend with metadata and waveform
6. **Visualization**: Canvas draws waveform with filled area under curve

### API Endpoints

#### POST `/api/upload`
- **Purpose**: Upload and process audio file
- **Input**: FormData with audio file
- **Output**: JSON with audio metadata and waveform data
- **Processing Time**: ~1-2 seconds for typical audio files

#### GET `/api/health`
- **Purpose**: Health check for service monitoring
- **Output**: JSON with status message

## Testing

### Automated Tests

Run the test script:
```bash
cd backend
source venv/bin/activate
python test_upload.py
```

**Test Results:**
- ✅ Health check endpoint: Working
- ✅ Upload endpoint: Working
- ✅ File processing: 5-second audio processed successfully
- ✅ Waveform generation: 1000 data points generated
- ✅ Metadata extraction: All fields populated correctly

### Manual Testing

1. **Start the Flask server:**
   ```bash
   cd backend
   source venv/bin/activate
   python app.py
   ```
   Server runs on `http://localhost:5000`

2. **Open the frontend:**
   - Open `http://localhost:5000` in browser
   - Or open `frontend/index.html` directly

3. **Test file upload:**
   - Drag and drop an audio file
   - Or click "Select File" button
   - View waveform and metadata

### Test Results

**Test File:** `backend/experiments/test_audio.wav`
- Duration: 5.00 seconds
- Sample Rate: 22050 Hz
- Total Samples: 110,250
- RMS Energy: 0.5838
- Waveform Points: 1000

## File Structure

```
assignment47/
├── backend/
│   ├── app.py                          # Flask application (NEW)
│   ├── test_upload.py                  # Test script (NEW)
│   ├── uploads/                        # Upload directory (created at runtime)
│   ├── experiments/
│   │   └── test_audio.wav              # Test file (from Week 1)
│   └── requirements.txt                # Dependencies (unchanged)
│
├── frontend/
│   └── index.html                      # Web interface (NEW)
│
├── .gitignore                          # Updated to exclude uploads/
├── WEEK_17_11_25.md                    # This file (NEW)
└── README.md                           # Project overview (unchanged)
```

## How to Run

### Prerequisites
- Python 3.8+
- Virtual environment activated
- Dependencies installed

### Steps

1. **Activate virtual environment:**
   ```bash
   cd backend
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

2. **Start the Flask server:**
   ```bash
   python app.py
   ```

3. **Access the application:**
   - Open browser to `http://localhost:5000`
   - Upload an audio file (MP3, WAV, OGG, FLAC, M4A)
   - View the waveform visualization

## Key Learnings

1. **Librosa Integration**: Successfully integrated Librosa for audio processing
2. **Efficient Data Transfer**: Downsampling waveform data reduces payload size
3. **Canvas Visualization**: HTML5 Canvas provides smooth waveform rendering
4. **File Validation**: Proper validation prevents server errors and improves UX
5. **Responsive Design**: CSS Grid and Flexbox create adaptive layouts

## Constraints Followed

✅ **Implemented ONLY this week's features:**
- Audio file upload ✓
- Basic waveform display ✓
- Metadata extraction ✓

❌ **Did NOT implement future features:**
- MFCC/Chroma extraction (Week 24/11/25)
- Similarity calculation (Week 1/12/25)
- Comparison visualization (Week 8/12/25)
- Database storage (future milestone)

## Performance Metrics

- **Upload Time**: < 1 second for files under 5MB
- **Processing Time**: 1-2 seconds for typical audio files
- **Visualization**: Renders instantly with 1000 data points
- **Memory Usage**: Minimal due to waveform downsampling

## Next Steps (Week 24/11/25)

The next milestone will focus on feature extraction:
- Develop feature extraction module (MFCC or chroma features)
- Integrate with upload system
- Save/retrieve extracted features
- Performance testing

## References

- Flask Documentation: https://flask.palletsprojects.com/
- Librosa Documentation: https://librosa.org/
- Web Audio API: https://developer.mozilla.org/en-US/Web_Audio_API
- HTML5 Canvas: https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API

---

**Week:** 17/11/25
**Completed:** 20/11/25
**Time Spent:** Approximately 1 week of development
**Status:** ✅ All milestone objectives achieved
